var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,n,t,o){return{replace:!0,scope:{visible:"=",source:"=imagoImage"},templateUrl:"/imago/imagoImage.html",controller:"imagoImageController",link:function(t,a,r){var s,l,u,c,g,m,d,v,h;m={},c={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:2560};for(u in r)v=r[u],c[u]="true"===v||"false"===v?JSON.parse(v):v;return m.watch=t.$watch("source",function(e){return function(e){var i;if(e)return r.watch||m.watch(),(null!=(i=t.source)?i.serving_url:void 0)?(t.source.fields.hasOwnProperty("crop")&&!r.align&&(c.align=t.source.fields.crop.value),t.source.fields.hasOwnProperty("sizemode")&&("default"===t.source.fields.sizemode.value||r.sizemode||(c.sizemode=t.source.fields.sizemode.value)),c.responsive&&"crop"===c.sizemode&&t.$on("resizelimit",function(){return s(),t.$evalAsync()}),l()):void a.remove()}}(this)),l=function(){var i,n,r,s,l,u;return angular.isString(t.source.resolution)&&(r=t.source.resolution.split("x"),c.resolution={width:r[0],height:r[1]},c.assetRatio=r[0]/r[1]),"preloading"===t.status?console.log("tried to render during rendering!!"):(t.status="preloading",t.align=c.align,t.sizemode=c.sizemode,l=a[0].clientWidth,n=a[0].clientHeight,n&&(u=l/n),i=c.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===c.sizemode&&n?s=Math.round(c.assetRatio<=u?Math.max(l,l/c.assetRatio):Math.max(n,n*c.assetRatio)):n&&"height"!==c.autosize?l&&"width"!==c.autosize?s=Math.round(c.assetRatio<=u?Math.max(n,n*c.assetRatio):Math.max(l,l/c.assetRatio)):(c.autosize="width",s=Math.round(Math.max(n,n*c.assetRatio))):(c.autosize="height",s=Math.round(Math.max(l,l/c.assetRatio))),s=parseInt(Math.min(s*i,c.maxsize),10),s===c.servingSize?void(t.status="loaded"):(c.servingSize=s,c.servingUrl=o.isBaseString(t.source.serving_url)?t.source.serving_url:t.source.serving_url+"=s"+s*c.scale,g()))},g=function(){var e;return c.lazy&&!t.visible?m.visibleFunc=t.$watch("visible",function(e){return function(e){return e?(m.visibleFunc(),g()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===c.sizemode?t.imageStyle={backgroundImage:"url("+c.servingUrl+")",backgroundSize:s(),backgroundPosition:c.align}:t.servingUrl=c.servingUrl,t.status="loaded",t.$evalAsync()}),e[0].src=c.servingUrl)},s=function(){var e,i,n;return i=a[0].clientWidth,e=a[0].clientHeight,e&&(n=i/e),"crop"===c.sizemode?t.imageStyle["background-size"]=c.assetRatio<n?"100% auto":"auto 100%":void 0},d=function(){var e;return"crop"===c.sizemode?e={backgroundImage:"url("+c.servingUrl+")",backgroundSize:s(),backgroundPosition:c.align}:void(t.servingUrl=c.servingUrl)},h={},c.responsive&&(h.resizestop=i.$on("resizestop",function(){return t.status="loading",t.source?l():void 0})),t.$on("$stateChangeSuccess",function(){return n(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})}),angular.element(e).on("orientationchange",l),t.$on("$destroy",function(){var e;e=[];for(u in h)e.push(h[u]());return e})}}}return e}(),imagoImageController=function(){function e(e){e.status="loading",e.imageStyle={}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$log","imagoUtils",imagoImage]).controller("imagoImageController",["$scope",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imagoImage.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
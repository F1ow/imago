var imagoImage;imagoImage=function(){function e(e,i,n,t,a){return{replace:!0,scope:{visible:"=",source:"=imagoImage"},templateUrl:"/imago/imagoImage.html",controller:function(e,i,n){return e.status="loading",e.imageStyle={}},link:function(t,o,s){var r,u,l,c,g,d,v,m,h;d={},c={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:2560};for(l in s)m=s[l],c[l]="true"===m||"false"===m?JSON.parse(m):m;return d.watch=t.$watch("source",function(e){return function(e){var i;if(e)return s.watch||d.watch(),(null!=(i=t.source)?i.serving_url:void 0)?(t.source.fields.hasOwnProperty("crop")&&!s.align&&(c.align=t.source.fields.crop.value),t.source.fields.hasOwnProperty("sizemode")&&("default"===t.source.fields.sizemode.value||s.sizemode||(c.sizemode=t.source.fields.sizemode.value)),c.responsive&&"crop"===c.sizemode&&t.$on("resizelimit",function(){return r(),t.$evalAsync()}),u()):void o.remove()}}(this)),u=function(){var i,n,s,r,u,l;return angular.isString(t.source.resolution)&&(s=t.source.resolution.split("x"),c.resolution={width:s[0],height:s[1]},c.assetRatio=s[0]/s[1]),"preloading"===t.status?console.log("tried to render during rendering!!"):(t.status="preloading",t.align=c.align,t.sizemode=c.sizemode,u=o[0].clientWidth,n=o[0].clientHeight,n&&(l=u/n),i=c.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===c.sizemode&&n?r=Math.round(c.assetRatio<=l?Math.max(u,u/c.assetRatio):Math.max(n,n*c.assetRatio)):n&&"height"!==c.autosize?u&&"width"!==c.autosize?r=Math.round(c.assetRatio<=l?Math.max(n,n*c.assetRatio):Math.max(u,u/c.assetRatio)):(c.autosize="width",r=Math.round(Math.max(n,n*c.assetRatio))):(c.autosize="height",r=Math.round(Math.max(u,u/c.assetRatio))),r=parseInt(Math.min(r*i,c.maxsize),10),r===c.servingSize?void(t.status="loaded"):(c.servingSize=r,c.servingUrl=a.isBaseString(t.source.serving_url)?t.source.serving_url:t.source.serving_url+"=s"+r*c.scale,g()))},g=function(){var e;return c.lazy&&!t.visible?d.visibleFunc=t.$watch("visible",function(e){return function(e){return e?(d.visibleFunc(),g()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===c.sizemode?t.imageStyle={backgroundImage:"url("+c.servingUrl+")",backgroundSize:r(),backgroundPosition:c.align}:t.servingUrl=c.servingUrl,t.status="loaded",t.$evalAsync()}),e[0].src=c.servingUrl)},r=function(){var e,i,n;return i=o[0].clientWidth,e=o[0].clientHeight,e&&(n=i/e),"crop"===c.sizemode?t.imageStyle["background-size"]=c.assetRatio<n?"100% auto":"auto 100%":void 0},v=function(){var e;return"crop"===c.sizemode?e={backgroundImage:"url("+c.servingUrl+")",backgroundSize:r(),backgroundPosition:c.align}:void(t.servingUrl=c.servingUrl)},h=[],c.responsive&&h.push(i.$on("resizestop",function(){return t.status="loading",t.source?u():void 0})),t.$on("$stateChangeSuccess",function(){return n(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})}),angular.element(e).on("orientationchange",u),t.$on("$destroy",function(){var e,i,n,t;for(n=[],e=0,i=h.length;i>e;e++)t=h[e],n.push(t());return n})}}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$log","imagoUtils",imagoImage]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imagoImage.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
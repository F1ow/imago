var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,n,o,t,a,r){return{replace:!0,scope:!0,templateUrl:"/imago/imagoImage.html",controller:"imagoImageController",link:function(o,t,s){var l,u,c,g,m,d,v,h,f,p,w;h={},o.visible=!1,o.source=void 0,d={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:2560};for(m in s)p=s[m],d[m]="true"===p||"false"===p?JSON.parse(p):p;return g=/[0-9a-fA-F]{24}/,h.watch=s.imagoImage.match(g)?s.$observe("imagoImage",function(e){return e?(o.source=r.find({_id:e}),s.watch||h.watch(),u()):void 0}):o.$watch(s.imagoImage,function(e){return function(e){return e?(o.source=e,s.watch||h.watch(),u()):void 0}}(this)),u=function(){var e;return(null!=(e=o.source)?e.serving_url:void 0)?(o.source.fields.hasOwnProperty("crop")&&!s.align&&(d.align=o.source.fields.crop.value),o.source.fields.hasOwnProperty("sizemode")&&("default"===o.source.fields.sizemode.value||s.sizemode||(d.sizemode=o.source.fields.sizemode.value)),d.responsive&&"crop"===d.sizemode&&o.$on("resizelimit",function(){return l(),o.$evalAsync()}),c()):void t.remove()},c=function(){var i,n,r,s,l,u;return angular.isString(o.source.resolution)&&(r=o.source.resolution.split("x"),d.resolution={width:r[0],height:r[1]},d.assetRatio=r[0]/r[1]),"preloading"===o.status?console.log("tried to render during rendering!!"):(o.status="preloading",o.align=d.align,o.sizemode=d.sizemode,l=t[0].clientWidth,n=t[0].clientHeight,n&&(u=l/n),i=d.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===d.sizemode&&n?s=Math.round(d.assetRatio<=u?Math.max(l,l/d.assetRatio):Math.max(n,n*d.assetRatio)):n&&"height"!==d.autosize?l&&"width"!==d.autosize?s=Math.round(d.assetRatio<=u?Math.max(n,n*d.assetRatio):Math.max(l,l/d.assetRatio)):(d.autosize="width",s=Math.round(Math.max(n,n*d.assetRatio))):(d.autosize="height",s=Math.round(Math.max(l,l/d.assetRatio))),s=parseInt(Math.min(s*i,d.maxsize),10),s===d.servingSize?void(o.status="loaded"):(d.servingSize=s,d.servingUrl=a.isBaseString(o.source.serving_url)?o.source.serving_url:o.source.serving_url+"=s"+s*d.scale,v()))},v=function(){var e;return d.lazy&&!o.visible?h.visibleFunc=o.$watch("visible",function(e){return function(e){return e?(h.visibleFunc(),o.visible=!0,v()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===d.sizemode?o.imageStyle={backgroundImage:"url("+d.servingUrl+")",backgroundSize:l(),backgroundPosition:d.align}:o.servingUrl=d.servingUrl,o.status="loaded",o.$evalAsync()}),e[0].src=d.servingUrl)},l=function(){var e,i,n;return i=t[0].clientWidth,e=t[0].clientHeight,e&&(n=i/e),"crop"===d.sizemode?o.imageStyle["background-size"]=d.assetRatio<n?"100% auto":"auto 100%":void 0},f=function(){var e;return"crop"===d.sizemode?e={backgroundImage:"url("+d.servingUrl+")",backgroundSize:l(),backgroundPosition:d.align}:void(o.servingUrl=d.servingUrl)},w={},d.responsive&&(w.resizestop=i.$on("resizestop",function(){return o.status="loading",o.source?c():void 0})),o.$on("$stateChangeSuccess",function(){return n(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})}),angular.element(e).on("orientationchange",c),o.$on("$destroy",function(){var e;e=[];for(m in w)e.push(w[m]());return e})}}}return e}(),imagoImageController=function(){function e(e){e.status="loading",e.imageStyle={}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$parse","$log","imagoUtils","imagoModel",imagoImage]).controller("imagoImageController",["$scope",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imagoImage.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
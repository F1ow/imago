var imagoImage;imagoImage=function(){function e(e,i,n,t,a){return{replace:!0,scope:{visible:"=",source:"=imagoImage"},templateUrl:"/imago/imagoImage.html",controller:function(e,i,n){return e.status="loading",e.imageStyle={}},link:function(t,s,o){var r,l,u,c,g,d,m,v,h;d={},c={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:2560};for(u in o)v=o[u],c[u]="true"===v||"false"===v?JSON.parse(v):v;return d.watch=t.$watch("source",function(e){return function(e){var i;if(e)return o.watch||d.watch(),(null!=(i=t.source)?i.serving_url:void 0)?(t.source.fields.hasOwnProperty("crop")&&!o.align&&(c.align=t.source.fields.crop.value),t.source.fields.hasOwnProperty("sizemode")&&("default"===t.source.fields.sizemode.value||o.sizemode||(c.sizemode=t.source.fields.sizemode.value)),c.responsive&&"crop"===c.sizemode&&t.$on("resizelimit",function(){return r(),t.$evalAsync()}),l()):void s.remove()}}(this)),l=function(){var i,n,o,r,l,u;return angular.isString(t.source.resolution)&&(o=t.source.resolution.split("x"),c.resolution={width:o[0],height:o[1]},c.assetRatio=o[0]/o[1]),"preloading"===t.status?console.log("tried to render during rendering!!"):(t.status="preloading",t.align=c.align,t.sizemode=c.sizemode,l=s[0].clientWidth,n=s[0].clientHeight,n&&(u=l/n),i=c.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===c.sizemode&&n?r=Math.round(c.assetRatio<=u?Math.max(l,l/c.assetRatio):Math.max(n,n*c.assetRatio)):n&&"height"!==c.autosize?l&&"width"!==c.autosize?r=Math.round(c.assetRatio<=u?Math.max(n,n*c.assetRatio):Math.max(l,l/c.assetRatio)):(c.autosize="width",r=Math.round(Math.max(n,n*c.assetRatio))):(c.autosize="height",r=Math.round(Math.max(l,l/c.assetRatio))),r=parseInt(Math.min(r*i,c.maxsize),10),r===c.servingSize?void(t.status="loaded"):(c.servingSize=r,c.servingUrl=a.isBaseString(t.source.serving_url)?t.source.serving_url:t.source.serving_url+"=s"+r*c.scale,g()))},g=function(){var e;return c.lazy&&!t.visible?d.visibleFunc=t.$watch("visible",function(e){return function(e){return e?(d.visibleFunc(),g()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===c.sizemode?t.imageStyle={backgroundImage:"url("+c.servingUrl+")",backgroundSize:r(),backgroundPosition:c.align}:t.servingUrl=c.servingUrl,t.status="loaded",t.$evalAsync()}),e[0].src=c.servingUrl)},r=function(){var e,i,n;return i=s[0].clientWidth,e=s[0].clientHeight,e&&(n=i/e),"crop"===c.sizemode?t.imageStyle["background-size"]=c.assetRatio<n?"100% auto":"auto 100%":void 0},m=function(){var e;return"crop"===c.sizemode?e={backgroundImage:"url("+c.servingUrl+")",backgroundSize:r(),backgroundPosition:c.align}:void(t.servingUrl=c.servingUrl)},h=[],c.responsive&&h.push(i.$on("resizestop",function(){return t.status="loading",t.source?l():void 0})),t.$on("$stateChangeSuccess",function(){return n(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})}),angular.element(e).on("orientationchange",l),t.$on("$destroy",function(){var e,i,n,t;for(n=[],e=0,i=h.length;i>e;e++)t=h[e],n.push(t());return n})}}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$log","imagoUtils",imagoImage]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imagoImage.html",'<div visible="visible" in-view="visible = $inview" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
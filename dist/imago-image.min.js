var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,a,o,t,n,r){return{replace:!0,scope:!0,templateUrl:"/imago/imago-image.html",controller:"imagoImageController as imagoimage",bindToController:!0,link:function(o,t,s){var g,l,m,u,c,d,v,h,f,p,z;h={},o.visible=!1,o.source=void 0,d={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:4e3};for(c in s)p=s[c],d[c]="true"===p||"false"===p?JSON.parse(p):p;return o.imagoimage.opts=d,u=/[0-9a-fA-F]{24}/,h.watch=s.imagoImage.match(u)?s.$observe("imagoImage",function(e){return e?(o.source=r.find({_id:e}),s.watch||h.watch(),l()):void 0}):o.$watch(s.imagoImage,function(e){return function(e){return e?(o.source=e,s.watch||h.watch(),l()):void 0}}(this)),l=function(){var e;return d.servingSize=null,(null!=(e=o.source)?e.serving_url:void 0)?(o.source.fields.hasOwnProperty("crop")&&!s.align&&(d.align=o.source.fields.crop.value),o.source.fields.hasOwnProperty("sizemode")&&("default"===o.source.fields.sizemode.value||s.sizemode||(d.sizemode=o.source.fields.sizemode.value)),d.responsive&&"crop"===d.sizemode&&o.$on("resizelimit",function(){return g(),o.$evalAsync()}),m()):void t.remove()},m=function(){var i,a,r,s,g,l;return angular.isString(o.source.resolution)&&(r=o.source.resolution.split("x"),d.resolution={width:r[0],height:r[1]},d.assetRatio=r[0]/r[1]),"preloading"===o.imagoimage.status?console.log("tried to render during rendering!!"):(o.imagoimage.status="preloading",o.align=d.align,o.sizemode=d.sizemode,g=t[0].clientWidth,a=t[0].clientHeight,a&&(l=g/a),i=d.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===d.sizemode&&a?s=Math.round(d.assetRatio<=l?Math.max(g,g/d.assetRatio):Math.max(a,a*d.assetRatio)):a&&"height"!==d.autosize?g&&"width"!==d.autosize?s=Math.round(d.assetRatio<=l?Math.max(a,a*d.assetRatio):Math.max(g,g/d.assetRatio)):(d.autosize="width",s=Math.round(Math.max(a,a*d.assetRatio))):(d.autosize="height",d.maxHeight=Math.round(g/d.assetRatio),s=Math.round(Math.max(g,g/d.assetRatio))),s=parseInt(Math.min(s*i,d.maxsize),10),s===d.servingSize?void(o.imagoimage.status="loaded"):(d.servingSize=s,d.servingUrl=n.isBaseString(o.source.serving_url)?o.source.serving_url:o.source.serving_url+"=s"+s*d.scale,v()))},v=function(){var e;return d.lazy&&!o.visible?h.visibleFunc=o.$watch("visible",function(e){return function(e){return e?(h.visibleFunc(),o.visible=!0,v()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===d.sizemode?o.imagoimage.imageStyle={backgroundImage:"url("+d.servingUrl+")",backgroundSize:g(),backgroundPosition:d.align}:(o.servingUrl=d.servingUrl,d.maxHeight&&(o.imagoimage.imageStyle={"max-height":d.maxHeight+"px"})),o.imagoimage.status="loaded",o.$evalAsync()}),e[0].src=d.servingUrl)},g=function(){var e,i,a;return i=t[0].clientWidth,e=t[0].clientHeight,e&&(a=i/e),"crop"===d.sizemode?o.imagoimage.imageStyle["background-size"]=d.assetRatio<a?"100% auto":"auto 100%":void 0},f=function(){var e;return"crop"===d.sizemode?e={backgroundImage:"url("+d.servingUrl+")",backgroundSize:g(),backgroundPosition:d.align}:void(o.servingUrl=d.servingUrl)},z={},d.responsive&&(z.resizestop=i.$on("resizestop",function(){return o.imagoimage.status="loading",o.source?m():void 0})),o.$on("$stateChangeSuccess",function(){return a(function(){return n.fireEvent("checkInView")})}),angular.element(e).on("orientationchange",m),o.$on("$destroy",function(){var e;e=[];for(c in z)e.push(z[c]());return e})}}}return e}(),imagoImageController=function(){function e(e){this.status="loading",this.imageStyle={},angular.isDefined(e.lazy)&&"false"===e.lazy&&(this.removeInView=!0)}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$parse","$log","imagoUtils","imagoModel",imagoImage]).controller("imagoImageController",["$attrs",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imago-image.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" in-view-remove="imagoimage.removeInView" ng-style="elementStyle" ng-class="[imagoimage.status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imagoimage.imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imagoimage.imageStyle" ng-switch-when="crop" class="imagox23"></div><div ng-show="imagoimage.status === \'preloading\'" class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
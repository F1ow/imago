var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,o,n,t,a,r){return{replace:!0,scope:!0,templateUrl:"/imago/imago-image.html",controller:"imagoImageController",link:function(n,t,s){var l,u,g,c,m,d,v,h,f,p,z;h={},n.visible=!1,n.source=void 0,d={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:4e3};for(m in s)p=s[m],d[m]="true"===p||"false"===p?JSON.parse(p):p;return c=/[0-9a-fA-F]{24}/,h.watch=s.imagoImage.match(c)?s.$observe("imagoImage",function(e){return e?(n.source=r.find({_id:e}),s.watch||h.watch(),u()):void 0}):n.$watch(s.imagoImage,function(e){return function(e){return e?(n.source=e,s.watch||h.watch(),u()):void 0}}(this)),u=function(){var e;return d.servingSize=null,(null!=(e=n.source)?e.serving_url:void 0)?(n.source.fields.hasOwnProperty("crop")&&!s.align&&(d.align=n.source.fields.crop.value),n.source.fields.hasOwnProperty("sizemode")&&("default"===n.source.fields.sizemode.value||s.sizemode||(d.sizemode=n.source.fields.sizemode.value)),d.responsive&&"crop"===d.sizemode&&n.$on("resizelimit",function(){return l(),n.$evalAsync()}),g()):void t.remove()},g=function(){var i,o,r,s,l,u;return angular.isString(n.source.resolution)&&(r=n.source.resolution.split("x"),d.resolution={width:r[0],height:r[1]},d.assetRatio=r[0]/r[1]),"preloading"===n.status?console.log("tried to render during rendering!!"):(n.status="preloading",n.align=d.align,n.sizemode=d.sizemode,l=t[0].clientWidth,o=t[0].clientHeight,o&&(u=l/o),i=d.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===d.sizemode&&o?s=Math.round(d.assetRatio<=u?Math.max(l,l/d.assetRatio):Math.max(o,o*d.assetRatio)):o&&"height"!==d.autosize?l&&"width"!==d.autosize?s=Math.round(d.assetRatio<=u?Math.max(o,o*d.assetRatio):Math.max(l,l/d.assetRatio)):(d.autosize="width",s=Math.round(Math.max(o,o*d.assetRatio))):(d.autosize="height",s=Math.round(Math.max(l,l/d.assetRatio))),s=parseInt(Math.min(s*i,d.maxsize),10),s===d.servingSize?void(n.status="loaded"):(d.servingSize=s,d.servingUrl=a.isBaseString(n.source.serving_url)?n.source.serving_url:n.source.serving_url+"=s"+s*d.scale,v()))},v=function(){var e;return d.lazy&&!n.visible?h.visibleFunc=n.$watch("visible",function(e){return function(e){return e?(h.visibleFunc(),n.visible=!0,v()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===d.sizemode?n.imageStyle={backgroundImage:"url("+d.servingUrl+")",backgroundSize:l(),backgroundPosition:d.align}:n.servingUrl=d.servingUrl,n.status="loaded",n.$evalAsync()}),e[0].src=d.servingUrl)},l=function(){var e,i,o;return i=t[0].clientWidth,e=t[0].clientHeight,e&&(o=i/e),"crop"===d.sizemode?n.imageStyle["background-size"]=d.assetRatio<o?"100% auto":"auto 100%":void 0},f=function(){var e;return"crop"===d.sizemode?e={backgroundImage:"url("+d.servingUrl+")",backgroundSize:l(),backgroundPosition:d.align}:void(n.servingUrl=d.servingUrl)},z={},d.responsive&&(z.resizestop=i.$on("resizestop",function(){return n.status="loading",n.source?g():void 0})),n.$on("$stateChangeSuccess",function(){return o(function(){return a.fireEvent("checkInView")})}),angular.element(e).on("orientationchange",g),n.$on("$destroy",function(){var e;e=[];for(m in z)e.push(z[m]());return e})}}}return e}(),imagoImageController=function(){function e(e){e.status="loading",e.imageStyle={}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$parse","$log","imagoUtils","imagoModel",imagoImage]).controller("imagoImageController",["$scope",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imago-image.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
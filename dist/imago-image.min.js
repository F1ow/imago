var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,o,n,t,a,r){return{replace:!0,scope:!0,templateUrl:"/imago/imagoImage.html",controller:"imagoImageController",link:function(n,t,s){var l,u,c,g,d,m,v,h,f,p,z;h={},n.visible=!1,n.source=void 0,m={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:2560};for(d in s)p=s[d],m[d]="true"===p||"false"===p?JSON.parse(p):p;return g=/[0-9a-fA-F]{24}/,h.watch=s.imagoImage.match(g)?s.$observe("imagoImage",function(e){return e?(n.source=r.find({_id:e}),s.watch||h.watch(),u()):void 0}):n.$watch(s.imagoImage,function(e){return function(e){return e?(n.source=e,s.watch||h.watch(),u()):void 0}}(this)),u=function(){var e;return(null!=(e=n.source)?e.serving_url:void 0)?(n.source.fields.hasOwnProperty("crop")&&!s.align&&(m.align=n.source.fields.crop.value),n.source.fields.hasOwnProperty("sizemode")&&("default"===n.source.fields.sizemode.value||s.sizemode||(m.sizemode=n.source.fields.sizemode.value)),m.responsive&&"crop"===m.sizemode&&n.$on("resizelimit",function(){return l(),n.$evalAsync()}),c()):void t.remove()},c=function(){var i,o,r,s,l,u;return angular.isString(n.source.resolution)&&(r=n.source.resolution.split("x"),m.resolution={width:r[0],height:r[1]},m.assetRatio=r[0]/r[1]),"preloading"===n.status?console.log("tried to render during rendering!!"):(n.status="preloading",n.align=m.align,n.sizemode=m.sizemode,l=t[0].clientWidth,o=t[0].clientHeight,o&&(u=l/o),i=m.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===m.sizemode&&o?s=Math.round(m.assetRatio<=u?Math.max(l,l/m.assetRatio):Math.max(o,o*m.assetRatio)):o&&"height"!==m.autosize?l&&"width"!==m.autosize?s=Math.round(m.assetRatio<=u?Math.max(o,o*m.assetRatio):Math.max(l,l/m.assetRatio)):(m.autosize="width",s=Math.round(Math.max(o,o*m.assetRatio))):(m.autosize="height",s=Math.round(Math.max(l,l/m.assetRatio))),s=parseInt(Math.min(s*i,m.maxsize),10),s===m.servingSize?void(n.status="loaded"):(m.servingSize=s,m.servingUrl=a.isBaseString(n.source.serving_url)?n.source.serving_url:n.source.serving_url+"=s"+s*m.scale,v()))},v=function(){var e;return m.lazy&&!n.visible?h.visibleFunc=n.$watch("visible",function(e){return function(e){return e?(h.visibleFunc(),n.visible=!0,v()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===m.sizemode?n.imageStyle={backgroundImage:"url("+m.servingUrl+")",backgroundSize:l(),backgroundPosition:m.align}:n.servingUrl=m.servingUrl,n.status="loaded",n.$evalAsync()}),e[0].src=m.servingUrl)},l=function(){var e,i,o;return i=t[0].clientWidth,e=t[0].clientHeight,e&&(o=i/e),"crop"===m.sizemode?n.imageStyle["background-size"]=m.assetRatio<o?"100% auto":"auto 100%":void 0},f=function(){var e;return"crop"===m.sizemode?e={backgroundImage:"url("+m.servingUrl+")",backgroundSize:l(),backgroundPosition:m.align}:void(n.servingUrl=m.servingUrl)},z={},m.responsive&&(z.resizestop=i.$on("resizestop",function(){return n.status="loading",n.source?c():void 0})),n.$on("$stateChangeSuccess",function(){return o(function(){var e;return document.createEvent&&!("undefined"!=typeof bowser&&null!==bowser?bowser.msie:void 0)?(console.log("document.createEvent",document.createEvent),e=new Event("checkInView"),window.dispatchEvent(e)):void 0})}),angular.element(e).on("orientationchange",c),n.$on("$destroy",function(){var e;e=[];for(d in z)e.push(z[d]());return e})}}}return e}(),imagoImageController=function(){function e(e){e.status="loading",e.imageStyle={}}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$parse","$log","imagoUtils","imagoModel",imagoImage]).controller("imagoImageController",["$scope",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imagoImage.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" ng-style="elementStyle" ng-class="[status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imageStyle" ng-switch-when="crop" class="imagox23"></div><div class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);
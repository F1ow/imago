var imagoControls;imagoControls=function(){function e(){return{replace:!0,require:"^imagoVideo",controllerAs:"imagocontrols",templateUrl:"/imago/controlsVideo.html",controller:function(e){var i;return i=angular.element(e.imagovideo.player),e.currentTime=0,i.bind("loadeddata",function(i){return e.duration=parseInt(i.target.duration),e.$digest()}),i.bind("timeupdate",function(i){return e.currentTime=i.target.currentTime,e.$digest()}),i.bind("seeking",function(i){return e.currentTime=i.target.currentTime,e.$digest()})},link:function(e,i,o){return e.seek=function(i){return e.imagovideo.player.currentTime=i},e.onVolumeChange=function(i){return function(i){return e.imagovideo.player.volume=parseFloat(i/100)}}(this),e.volumeDown=function(i){return function(){return e.imagovideo.player.volume=0,e.volumeInput=0}}(this),e.volumeUp=function(i){return function(){return e.imagovideo.player.volume=1,e.volumeInput=100}}(this),e.fullScreen=function(i){return function(){return e.imagovideo.player.requestFullscreen?e.imagovideo.player.requestFullscreen():e.imagovideo.player.webkitRequestFullscreen?e.imagovideo.player.webkitRequestFullscreen():e.imagovideo.player.mozRequestFullScreen?e.imagovideo.player.mozRequestFullScreen():e.imagovideo.player.msRequestFullscreen?e.imagovideo.player.msRequestFullscreen():void 0}}(this),i.bind("mouseup",function(e){return e.stopPropagation()}),i.bind("mousedown",function(e){return e.stopPropagation()})}}}return e}(),angular.module("imago").directive("imagoControls",[imagoControls]);var imagoVideo;imagoVideo=function(){function e(e,i,o,t,n){return{replace:!0,scope:{visible:"=",source:"=imagoVideo"},templateUrl:"/imago/imagoVideo.html",controllerAs:"imagovideo",controller:function(e,i,o,t){this.player=i.find("video")[0],e.loading=!0,angular.element(this.player).bind("ended",function(e){return function(i){return e.player.currentTime=0,e.state="end"}}(this)),angular.element(this.player).bind("loadeddata",function(i){return function(){return e.hasPlayed=!0,angular.element(i.player).unbind("loadeddata")}}(this)),angular.element(this.player).bind("play",function(e){return function(){return e.state="playing"}}(this)),this.togglePlay=function(e){return function(){return e.player.paused?(e.state="playing",e.player.play()):(e.state="paused",e.player.pause())}}(this)},link:function(e,t,a){var r,l,s,u,c,d,p,g,m,v,f,h,y;g={},c={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",lazy:!0,hires:!0,loop:!1,width:"",height:""};for(l in a)h=a[l],c[l]="true"===h||"false"===h?JSON.parse(h):"width"===l||"height"===l?"auto"===h?h:parseInt(h):h;return g.watch=e.$watch("source",function(i){return function(i){var o,n,r;if(i)return a.watch||g.watch(),(null!=(o=e.source.fields)&&null!=(n=o.formats)?n.length:void 0)?(null!=(r=e.source)?r.serving_url:void 0)?(e.source.fields.hasOwnProperty("crop")&&!a.align&&(c.align=e.source.fields.crop.value),e.source.fields.hasOwnProperty("sizemode")&&("default"===e.source.fields.sizemode.value||a.sizemode||(c.sizemode=e.source.fields.sizemode.value)),d()):void t.remove():console.log("no formats found")}}(this)),d=function(){var i,o,n,a,r,l,u;return angular.isString(e.source.resolution)&&(n=e.source.resolution.split("x"),a={width:n[0],height:n[1]},c.assetRatio=n[0]/n[1]),e.controls=c.controls,c.width&&c.height?(u=c.width,o=c.height):(u=t[0].clientWidth,o=t[0].clientHeight),i=c.hires?Math.ceil(window.devicePixelRatio)||1:1,r=e.source.serving_url+"=s"+(Math.ceil(Math.min(Math.max(u,o)*i))||1600),l={size:c.size,sizemode:c.sizemode,backgroundPosition:c.align,backgroundImage:"url("+r+")",backgroundRepeat:"no-repeat"},e.wrapperStyle=l,m(),e.videoFormats=s(),p(u,o,r)},m=function(){return c.autoplay===!0&&e.imagovideo.player.setAttribute("autoplay",!0),e.imagovideo.player.setAttribute("preload",c.preload),e.imagovideo.player.setAttribute("x-webkit-airplay","allow"),e.imagovideo.player.setAttribute("webkitAllowFullscreen",!0),c.loop===!0?e.imagovideo.player.setAttribute("loop",c.loop):void 0},p=function(i){return function(i,o,t){var n;return c.lazy&&!e.visible?g.visibleFunc=e.$watch("visible",function(e){return e?(g.visibleFunc(),p(i,o,t)):void 0}):(n=angular.element("<img>"),n.on("load",function(t){return _.assign(e.wrapperStyle,f(i,o)),e.videoStyle=v(i,o),e.loading=!1,e.$apply()}),n[0].src=t)}}(this),f=function(e,i){var o,t;if(e&&i)return o={},t=e/i,"crop"===c.sizemode?o.backgroundSize=c.assetRatio<t?"100% auto":"auto 100%":c.assetRatio<t?(o.width=Math.round(i*c.assetRatio)+"px",o.height=i+"px",o.backgroundSize="auto 100%"):(o.width=e+"px",o.height=Math.round(e/c.assetRatio)+"px",o.backgroundSize="100% auto"),o},v=function(e){return function(e,i){var o,t;if(e&&i)return o={},t=e/i,n.isiOS()?(o.width="100%",o.height="100%","center center"===c.align&&"crop"===c.sizemode&&(o.top="0",o.left="0")):"crop"===c.sizemode?c.assetRatio<t?(o.width="100%",o.height="auto","center center"===c.align&&(o.top="50%",o.left="auto",o.marginTop="-"+Math.round(i/2)+"px",o.marginLeft="0px")):(o.width="auto",o.height="100%","center center"===c.align&&(o.top="auto",o.left="50%",o.marginTop="0px",o.marginLeft="-"+Math.round(e/2)+"px")):c.assetRatio<t?(o.width="auto",o.height="100%"):(o.width="100%",o.height="auto"),o}}(this),s=function(){var i,o,t,n,a,l,s,u;for(t=[],i=r(),e.source.fields.formats.sort(function(e,i){return i.height-e.height}),n="online"===data?"api.imago.io":"localhost:8000",u=e.source.fields.formats,a=l=0,s=u.length;s>l;a=++l)o=u[a],i===o.codec&&t.push({src:"//"+n+"/api/play_redirect?uuid="+e.source.uuid+"&codec="+o.codec+"&quality=hd&max_size="+o.size,size:o.size,codec:o.codec,type:"video/"+i});return t},r=function(){var i;if(e.imagovideo.player.canPlayType){i={mp4:'video/mp4; codecs="mp4v.20.8"',mp4:'video/mp4; codecs="avc1.42E01E"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora"'};for(l in i)if(h=i[l],e.imagovideo.player.canPlayType(h))return l}},e.toggleSize=function(){return"hd"===c.size?(c.size="sd",e.wrapperStyle.size="sd"):(c.size="hd",e.wrapperStyle.size="hd"),e.videoFormats.reverse(),i(function(){return e.imagovideo.player.load(),e.imagovideo.player.play()})},u=function(){var i,o;return o=t[0].clientWidth||c.width,i=t[0].clientHeight||c.height,_.assign(e.wrapperStyle,f(o,i)),e.videoStyle=v(o,i),e.$apply()},y={},y.resize=o.$on("resize",u),y.resizestop=o.$on("resizestop",function(){return d(e.source)}),e.$on("$destroy",function(){var e;e=[];for(l in y)e.push(y[l]());return e}),e.$on("$stateChangeSuccess",function(){return i(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})})}}}return e}(),angular.module("imago").directive("imagoVideo",["$q","$timeout","$rootScope","$window","imagoUtils",imagoVideo]);var Time;Time=function(){function e(){return function(e){var i,o,t,n,a;if("number"==typeof e)return n=function(e){return 10>e?"0"+e:e},i=[],t=Math.floor(e/60),o=Math.floor(e/3600),a=0===e?0:e%60,a=Math.round(a),o>0&&i.push(n(o)),i.push(n(t)),i.push(n(a)),i.join(":")}}return e}(),angular.module("imago").filter("time",[Time]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/controlsVideo.html",'<div stop-propagation="stop-propagation" class="controls"><a ng-click="imagovideo.togglePlay()" ng-class="{\'fa-pause\': imagovideo.state === \'playing\', \'fa-play\': imagovideo.state === \'paused\'}" class="video-play fa fa-play"></a><span class="video-time">{{currentTime | time}}</span><span class="video-seekbar"><input type="range" ng-model="currentTime" min="0" max="{{duration}}" ng-change="seek(currentTime)" class="seek"/></span><a ng-click="toggleSize()" class="size">{{wrapperStyle.size}}</a><span class="volume"><span ng-click="volumeUp()" class="fa fa-volume-up icon-volume-up"></span><input type="range" ng-model="volumeInput" ng-change="onVolumeChange(volumeInput)"/><span ng-click="volumeDown()" class="fa fa-volume-down icon-volume-down"></span></span><a ng-click="fullScreen()" class="video-fullscreen fa fa-expand"></a><a class="video-screen fa fa-compress"></a></div>'),e.put("/imago/imagoVideo.html",'<div ng-class="{loading: loading}" in-view="visible = $inview" visible="visible" responsive-events="responsive-events" class="imagovideo {{wrapperStyle.backgroundPosition}} {{wrapperStyle.size}} {{wrapperStyle.sizemode}}"><div ng-style="wrapperStyle" ng-class="imagovideo.state" class="imagowrapper"><a ng-hide="loading" ng-click="imagovideo.togglePlay()" ng-class="{playing: imagovideo.isPlaying}" stop-propagation="stop-propagation" class="playbig fa fa-play"></a><video ng-style="videoStyle"><source ng-repeat="format in videoFormats" src="{{format.src}}" data-size="{{format.size}}" data-codec="{{format.codec}}" type="{{format.type}}"/></video><div imago-controls="imago-controls" ng-style="controlStyle" ng-show="controls &amp;&amp; hasPlayed"></div></div></div>')}]);
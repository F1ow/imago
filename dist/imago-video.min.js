var imagoControls;imagoControls=function(){function e(){return{replace:!0,scope:!0,require:"^imagoVideo",templateUrl:"/imago/controlsVideo.html",controller:function(e){var t;return t=angular.element(e.player),e.currentTime=0,t.bind("loadeddata",function(t){return e.duration=parseInt(t.target.duration),e.$apply()}),t.bind("timeupdate",function(t){return e.currentTime=t.target.currentTime,e.$apply()}),t.bind("seeking",function(t){return e.currentTime=t.target.currentTime,e.$apply()})},link:function(e,t){return e.seek=function(t){return e.player.currentTime=t},e.onVolumeChange=function(){return function(t){return e.player.volume=parseFloat(t/100)}}(this),e.volumeDown=function(){return function(){return e.player.volume=0,e.volumeInput=0}}(this),e.volumeUp=function(){return function(){return e.player.volume=1,e.volumeInput=100}}(this),e.fullScreen=function(){return function(){return e.player.requestFullscreen?e.player.requestFullscreen():e.player.webkitRequestFullscreen?e.player.webkitRequestFullscreen():e.player.mozRequestFullScreen?e.player.mozRequestFullScreen():e.player.msRequestFullscreen?e.player.msRequestFullscreen():void 0}}(this),t.bind("mouseup",function(e){return e.stopPropagation()}),t.bind("mousedown",function(e){return e.stopPropagation()})}}}return e}(),angular.module("imago").directive("imagoControls",[imagoControls]);var imagoVideo;imagoVideo=function(){function e(e,t,i,n){return{replace:!0,scope:!0,templateUrl:"/imago/imagoVideo.html",controller:function(e,t){return e.player=t.find("video")[0],e.loading=!0,angular.element(e.player).bind("ended",function(){return e.player.currentTime=0,e.isPlaying=!1}),angular.element(e.player).bind("loadeddata",function(){return e.hasPlayed=!0,angular.element(e.player).unbind("loadeddata")}),angular.element(e.player).bind("play",function(){return e.isPlaying=!0})},link:function(e,i,a){var o,r,l,u,s,c,p,d,g,m,h,f;d={visible:!1},s={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",lazy:!0,hires:!0,loop:!1,width:"",height:""};for(r in a)f=a[r],s[r]="true"===f||"false"===f?JSON.parse(f):"width"===r||"height"===r?"auto"===f?f:parseInt(f):f;return d.watch=e.$watch(a.imagoVideo,function(){return function(e){var t;if(e)return a.watch||d.watch(),d.source=e,(null!=(t=d.source)?t.serving_url:void 0)?(d.source.fields.hasOwnProperty("crop")&&!a.align&&(s.align=d.source.fields.crop.value),d.source.fields.hasOwnProperty("sizemode")&&!a.sizemode&&(s.sizemode=d.source.fields.sizemode.value),c(d.source)):void i.remove()}}(this)),c=function(t){var n,a,o,r,u,c,m;return angular.isString(t.resolution)&&(o=t.resolution.split("x"),r={width:o[0],height:o[1]},s.assetRatio=o[0]/o[1]),e.controls=s.controls,s.width&&s.height?(m=s.width,a=s.height):(m=i[0].clientWidth,a=i[0].clientHeight),n=s.hires?Math.ceil(window.devicePixelRatio)||1:1,u=""+t.serving_url+"=s"+(Math.ceil(Math.min(Math.max(m,a)*n))||1600),c={size:s.size,sizemode:s.sizemode,backgroundPosition:s.align,backgroundImage:"url("+u+")",backgroundRepeat:"no-repeat"},e.wrapperStyle=c,g(),e.videoFormats=l(d.source),p(m,a,u)},g=function(){return s.autoplay===!0&&e.player.setAttribute("autoplay",!0),e.player.setAttribute("preload",s.preload),e.player.setAttribute("x-webkit-airplay","allow"),e.player.setAttribute("webkitAllowFullscreen",!0),e.player.setAttribute("loop",s.loop)},p=function(){return function(t,i,n){var o;return s.lazy&&!d.visible?d.visibleFunc=e.$watch(a.visible,function(e){return e?(d.visible=!0,d.visibleFunc(),p(t,i,n)):void 0}):(o=angular.element("<img>"),o.on("load",function(){return _.assign(e.wrapperStyle,h(t,i)),e.videoStyle=m(t,i),e.loading=!1,e.$apply()}),o[0].src=n)}}(this),h=function(e,t){var i,n;if(e&&t)return i={},n=e/t,"crop"===s.sizemode?i.backgroundSize=s.assetRatio<n?"100% auto":"auto 100%":s.assetRatio<n?(i.width=""+Math.round(t*s.assetRatio)+"px",i.height=""+t+"px",i.backgroundSize="auto 100%"):(i.width=""+e+"px",i.height=""+Math.round(e/s.assetRatio)+"px",i.backgroundSize="100% auto"),i},m=function(){return function(e,t){var i,a;if(e&&t)return i={},a=e/t,n.isiOS()?(i.width="100%",i.height="100%","center center"===s.align&&"crop"===s.sizemode&&(i.top="0",i.left="0")):"crop"===s.sizemode?s.assetRatio<a?(i.width="100%",i.height="auto","center center"===s.align&&(i.top="50%",i.left="auto",i.marginTop="-"+Math.round(t/2)+"px",i.marginLeft="0px")):(i.width="auto",i.height="100%","center center"===s.align&&(i.top="auto",i.left="50%",i.marginTop="0px",i.marginLeft="-"+Math.round(e/2)+"px")):s.assetRatio<a?(i.width="auto",i.height="100%"):(i.width="100%",i.height="auto"),i}}(this),l=function(e){var t,i,n,a,r,l,u;for(n=[],t=o(),e.fields.formats.sort(function(e,t){return t.height-e.height}),u=e.fields.formats,a=r=0,l=u.length;l>r;a=++r)i=u[a],t===i.codec&&n.push({src:"//api.2.imagoapp.com/api/play_redirect?uuid="+e.uuid+"&codec="+i.codec+"&quality=hd&max_size="+i.size,size:i.size,codec:i.codec,type:"video/"+t});return n},o=function(){var t;if(e.player.canPlayType){t={mp4:'video/mp4; codecs="mp4v.20.8"',mp4:'video/mp4; codecs="avc1.42E01E"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora"'};for(r in t)if(f=t[r],e.player.canPlayType(f))return r}},e.togglePlay=function(){return function(){return e.player.paused?e.player.play():(e.isPlaying=!1,e.player.pause())}}(this),e.toggleSize=function(){return"hd"===s.size?(s.size="sd",e.wrapperStyle.size="sd"):(s.size="hd",e.wrapperStyle.size="hd"),e.videoFormats.reverse(),t(function(){return e.player.load(),e.player.play()})},u=function(){var t,n;return n=i[0].clientWidth||s.width,t=i[0].clientHeight||s.height,_.assign(e.wrapperStyle,h(n,t)),e.videoStyle=m(n,t),e.$apply()},e.$on("resize",u),e.$on("resizestop",function(){return c(d.source)})}}}return e}(),angular.module("imago").directive("imagoVideo",["$q","$timeout","$window","imagoUtils",imagoVideo]);var Time;Time=function(){function e(){return function(e){var t,i,n,a,o;if("number"==typeof e)return a=function(e){return 10>e?"0"+e:e},t=[],n=Math.floor(e/60),i=Math.floor(e/3600),o=0===e?0:e%60,o=Math.round(o),i>0&&t.push(a(i)),t.push(a(n)),t.push(a(o)),t.join(":")}}return e}(),angular.module("imago").filter("time",[Time]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/controlsVideo.html",'<div stop-propagation="stop-propagation" ng-switch="isPlaying" class="controls"><a hm-tap="togglePlay" ng-switch-when="false" class="video-play fa fa-play"></a><a hm-tap="togglePlay" ng-switch-when="true" class="video-pause fa fa-pause"></a><span class="video-time">{{currentTime | time}}</span><span class="video-seekbar"><input type="range" ng-model="currentTime" min="0" max="{{duration}}" ng-change="seek(currentTime)" class="seek"/></span><a hm-tap="toggleSize" class="size">{{wrapperStyle.size}}</a><span class="volume"><span ng-click="volumeUp" class="fa fa-volume-up icon-volume-up"></span><input type="range" ng-model="volumeInput" ng-change="onVolumeChange(volumeInput)"/><span hm-tap="volumeDown" class="fa fa-volume-down icon-volume-down"></span></span><a hm-tap="fullScreen" class="video-fullscreen fa fa-expand"></a><a class="video-screen fa fa-compress"></a></div>'),e.put("/imago/imagoVideo.html",'<div ng-class="{loading: loading}" in-view="visible = $inview" visible="visible" responsive-events="responsive-events" class="imagovideo {{wrapperStyle.backgroundPosition}} {{wrapperStyle.size}} {{wrapperStyle.sizemode}}"><div ng-style="wrapperStyle" ng-class="{playing: isPlaying}" class="imagowrapper"><a ng-hide="loading" hm-tap="togglePlay()" ng-class="{playing: isPlaying}" stop-propagation="stop-propagation" class="playbig fa fa-play"></a><video ng-style="videoStyle"><source ng-repeat="format in videoFormats" src="{{format.src}}" data-size="{{format.size}}" data-codec="{{format.codec}}" type="{{format.type}}"/></video><div imago-controls="imago-controls" ng-style="controlStyle" ng-if="controls" ng-show="hasPlayed"></div></div></div>')}]);
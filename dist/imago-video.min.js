var imagoControls;imagoControls=function(){function e(){return{replace:!0,require:"^imagoVideo",controllerAs:"imagocontrols",templateUrl:"/imago/controlsVideo.html",controller:function(e){var i;return i=angular.element(e.imagovideo.player),e.currentTime=0,i.bind("loadeddata",function(i){return e.duration=parseInt(i.target.duration),e.$digest()}),i.bind("timeupdate",function(i){return e.currentTime=i.target.currentTime,e.$digest()}),i.bind("seeking",function(i){return e.currentTime=i.target.currentTime,e.$digest()})},link:function(e,i,o){return e.seek=function(i){return e.imagovideo.player.currentTime=i},e.onVolumeChange=function(i){return function(i){return e.imagovideo.player.volume=parseFloat(i/100)}}(this),e.volumeDown=function(i){return function(){return e.imagovideo.player.volume=0,e.volumeInput=0}}(this),e.volumeUp=function(i){return function(){return e.imagovideo.player.volume=1,e.volumeInput=100}}(this),e.fullScreen=function(i){return function(){return e.imagovideo.player.requestFullscreen?e.imagovideo.player.requestFullscreen():e.imagovideo.player.webkitRequestFullscreen?e.imagovideo.player.webkitRequestFullscreen():e.imagovideo.player.mozRequestFullScreen?e.imagovideo.player.mozRequestFullScreen():e.imagovideo.player.msRequestFullscreen?e.imagovideo.player.msRequestFullscreen():void 0}}(this),i.bind("mouseup",function(e){return e.stopPropagation()}),i.bind("mousedown",function(e){return e.stopPropagation()})}}}return e}(),angular.module("imago").directive("imagoControls",[imagoControls]);var imagoVideo;imagoVideo=function(){function e(e,i,o,t){return{replace:!0,scope:{visible:"=",source:"=imagoVideo"},templateUrl:"/imago/imagoVideo.html",controllerAs:"imagovideo",controller:function(e,i,o,t){return this.player=i.find("video")[0],e.loading=!0,angular.element(this.player).bind("ended",function(e){return function(i){return e.player.currentTime=0,e.isPlaying=!1}}(this)),angular.element(this.player).bind("loadeddata",function(i){return function(){return e.hasPlayed=!0,angular.element(i.player).unbind("loadeddata")}}(this)),angular.element(this.player).bind("play",function(e){return function(){return e.isPlaying=!0}}(this)),this.togglePlay=function(e){return function(){return e.player.paused?e.player.play():(e.isPlaying=!1,e.player.pause())}}(this)},link:function(e,o,n){var a,r,l,s,u,c,d,p,g,m,v,h;p={},u={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",lazy:!0,hires:!0,loop:!1,width:"",height:""};for(r in n)h=n[r],u[r]="true"===h||"false"===h?JSON.parse(h):"width"===r||"height"===r?"auto"===h?h:parseInt(h):h;return p.watch=e.$watch("source",function(i){return function(i){var t;if(i)return n.watch||p.watch(),(null!=(t=e.source)?t.serving_url:void 0)?(e.source.fields.hasOwnProperty("crop")&&!n.align&&(u.align=e.source.fields.crop.value),e.source.fields.hasOwnProperty("sizemode")&&("default"===e.source.fields.sizemode.value||n.sizemode||(u.sizemode=e.source.fields.sizemode.value)),c()):void o.remove()}}(this)),c=function(){var i,t,n,a,r,s,c;return angular.isString(e.source.resolution)&&(n=e.source.resolution.split("x"),a={width:n[0],height:n[1]},u.assetRatio=n[0]/n[1]),e.controls=u.controls,u.width&&u.height?(c=u.width,t=u.height):(c=o[0].clientWidth,t=o[0].clientHeight),i=u.hires?Math.ceil(window.devicePixelRatio)||1:1,r=e.source.serving_url+"=s"+(Math.ceil(Math.min(Math.max(c,t)*i))||1600),s={size:u.size,sizemode:u.sizemode,backgroundPosition:u.align,backgroundImage:"url("+r+")",backgroundRepeat:"no-repeat"},e.wrapperStyle=s,g(),e.videoFormats=l(e.source),d(c,t,r)},g=function(){return u.autoplay===!0&&e.imagovideo.player.setAttribute("autoplay",!0),e.imagovideo.player.setAttribute("preload",u.preload),e.imagovideo.player.setAttribute("x-webkit-airplay","allow"),e.imagovideo.player.setAttribute("webkitAllowFullscreen",!0),u.loop===!0?e.imagovideo.player.setAttribute("loop",u.loop):void 0},d=function(i){return function(i,o,t){var n;return u.lazy&&!e.visible?p.visibleFunc=e.$watch("visible",function(e){return e?(p.visibleFunc(),d(i,o,t)):void 0}):(n=angular.element("<img>"),n.on("load",function(t){return _.assign(e.wrapperStyle,v(i,o)),e.videoStyle=m(i,o),e.loading=!1,e.$apply()}),n[0].src=t)}}(this),v=function(e,i){var o,t;if(e&&i)return o={},t=e/i,"crop"===u.sizemode?o.backgroundSize=u.assetRatio<t?"100% auto":"auto 100%":u.assetRatio<t?(o.width=Math.round(i*u.assetRatio)+"px",o.height=i+"px",o.backgroundSize="auto 100%"):(o.width=e+"px",o.height=Math.round(e/u.assetRatio)+"px",o.backgroundSize="100% auto"),o},m=function(e){return function(e,i){var o,n;if(e&&i)return o={},n=e/i,t.isiOS()?(o.width="100%",o.height="100%","center center"===u.align&&"crop"===u.sizemode&&(o.top="0",o.left="0")):"crop"===u.sizemode?u.assetRatio<n?(o.width="100%",o.height="auto","center center"===u.align&&(o.top="50%",o.left="auto",o.marginTop="-"+Math.round(i/2)+"px",o.marginLeft="0px")):(o.width="auto",o.height="100%","center center"===u.align&&(o.top="auto",o.left="50%",o.marginTop="0px",o.marginLeft="-"+Math.round(e/2)+"px")):u.assetRatio<n?(o.width="auto",o.height="100%"):(o.width="100%",o.height="auto"),o}}(this),l=function(e){var i,o,t,n,r,l,s,u;for(t=[],i=a(),e.fields.formats.sort(function(e,i){return i.height-e.height}),n="online"===data?"api.imago.io":"localhost:8000",u=e.fields.formats,r=l=0,s=u.length;s>l;r=++l)o=u[r],i===o.codec&&t.push({src:"//"+n+"/api/play_redirect?uuid="+e.uuid+"&codec="+o.codec+"&quality=hd&max_size="+o.size,size:o.size,codec:o.codec,type:"video/"+i});return t},a=function(){var i;if(e.imagovideo.player.canPlayType){i={mp4:'video/mp4; codecs="mp4v.20.8"',mp4:'video/mp4; codecs="avc1.42E01E"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora"'};for(r in i)if(h=i[r],e.imagovideo.player.canPlayType(h))return r}},e.toggleSize=function(){return"hd"===u.size?(u.size="sd",e.wrapperStyle.size="sd"):(u.size="hd",e.wrapperStyle.size="hd"),e.videoFormats.reverse(),i(function(){return e.imagovideo.player.load(),e.imagovideo.player.play()})},s=function(){var i,t;return t=o[0].clientWidth||u.width,i=o[0].clientHeight||u.height,_.assign(e.wrapperStyle,v(t,i)),e.videoStyle=m(t,i),e.$apply()},e.$on("resize",s),e.$on("resizestop",function(){return c(e.source)}),e.$on("$stateChangeSuccess",function(){return i(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})})}}}return e}(),angular.module("imago").directive("imagoVideo",["$q","$timeout","$window","imagoUtils",imagoVideo]);var Time;Time=function(){function e(){return function(e){var i,o,t,n,a;if("number"==typeof e)return n=function(e){return 10>e?"0"+e:e},i=[],t=Math.floor(e/60),o=Math.floor(e/3600),a=0===e?0:e%60,a=Math.round(a),o>0&&i.push(n(o)),i.push(n(t)),i.push(n(a)),i.join(":")}}return e}(),angular.module("imago").filter("time",[Time]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/controlsVideo.html",'<div stop-propagation="stop-propagation" class="controls"><a ng-click="imagovideo.togglePlay()" ng-class="{\'fa-pause\': imagovideo.isPlaying, \'fa-play\': !imagovideo.isPlaying}" class="video-play fa fa-play"></a><span class="video-time">{{currentTime | time}}</span><span class="video-seekbar"><input type="range" ng-model="currentTime" min="0" max="{{duration}}" ng-change="seek(currentTime)" class="seek"/></span><a ng-click="toggleSize()" class="size">{{wrapperStyle.size}}</a><span class="volume"><span ng-click="volumeUp()" class="fa fa-volume-up icon-volume-up"></span><input type="range" ng-model="volumeInput" ng-change="onVolumeChange(volumeInput)"/><span ng-click="volumeDown()" class="fa fa-volume-down icon-volume-down"></span></span><a ng-click="fullScreen()" class="video-fullscreen fa fa-expand"></a><a class="video-screen fa fa-compress"></a></div>'),e.put("/imago/imagoVideo.html",'<div ng-class="{loading: loading}" in-view="visible = $inview" visible="visible" responsive-events="responsive-events" class="imagovideo {{wrapperStyle.backgroundPosition}} {{wrapperStyle.size}} {{wrapperStyle.sizemode}}"><div ng-style="wrapperStyle" ng-class="{playing: imagovideo.isPlaying}" class="imagowrapper"><a ng-hide="loading" ng-click="imagovideo.togglePlay()" ng-class="{playing: imagovideo.isPlaying}" stop-propagation="stop-propagation" class="playbig fa fa-play"></a><video ng-style="videoStyle"><source ng-repeat="format in videoFormats" src="{{format.src}}" data-size="{{format.size}}" data-codec="{{format.codec}}" type="{{format.type}}"/></video><div imago-controls="imago-controls" ng-style="controlStyle" ng-show="controls &amp;&amp; hasPlayed"></div></div></div>')}]);
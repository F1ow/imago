var Checkout,__bind=function(t,n){return function(){return t.apply(n,arguments)}};Checkout=function(){function t(t,n,r,s,i,c){var e;this.$q=n,this.$http=r,this.$state=s,this.imagoSettings=i,this.calculation=c,this.setupStripe=__bind(this.setupStripe,this),e=[],e.push(this.$http.get(this.imagoSettings.host+"/api/carts?cartid="+this.$state.params.id).then(function(t){return function(n){return t.calculation.cart=n.data,t.calculation.currency=n.data.currency}}(this))),e.push(this.$http.get(this.imagoSettings.host+"/api/shippingmethods").then(function(t){return function(n){return t.calculation.shippingmethods=n.data}}(this))),e.push(this.$http.get(this.imagoSettings.host+"/api/taxrates").then(function(t){return function(n){return t.calculation.taxes=n.data}}(this))),e.push(this.$http.get(this.imagoSettings.host+"/api/settings").then(function(t){return function(n){var r,s;return r=_.find(n.data,{name:"currencies"}),t.calculation.currencies=r.value,t.setupStripe(n.data),s=_.find(n.data,{name:"taxincluded"}),t.calculation.taxincluded=s.value}}(this))),this.$q.all(e).then(function(t){return function(){return t.calculation.cart._id?(t.ready=!0,t.calculation.calculate()):"invalid cart"}}(this)),t.handleStripe=function(t){return function(n,r){return console.log("status stripe",n),r.error?(console.log("error stripe",r),400===n?t.invalidForm=!0:void 0):(t.stripe=r.card,t.stripe.token=r.id,t.calculation.process.form.card=t.stripe,t.calculation.submit())}}(this)}return t.prototype.messages={noshippingrule:"sorry we don't ship to that country"},t.prototype.setupStripe=function(t){var n;return(n=_.find(t,{name:"stripe"}))?Stripe.setPublishableKey(n.value):void 0},t}(),angular.module("imago").controller("checkout",["$scope","$q","$http","$state","imagoSettings","calculation",Checkout]);var Costs;Costs=function(){function t(){return{scope:{costs:"=",currency:"="},controllerAs:"costs",templateUrl:"/imago/costs.html"}}return t}(),angular.module("imago").directive("costs",[Costs]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/costs.html",'<table><tbody><tr><td>subtotal</td><td><span ng-bind-html="currency | currencySymbol" class="currency"></span>{{ costs.subtotal | price }}</td></tr><tr><td>shipping</td><td><span ng-bind-html="currency | currencySymbol" class="currency"></span>{{ costs.shipping | price }}</td></tr><tr ng-show="costs.includedTax"><td>included tax</td><td><span ng-bind-html="currency | currencySymbol" class="currency"></span>{{ costs.includedTax | price }}</td></tr><tr ng-show="!costs.includedTax"><td>tax</td><td><span ng-bind-html="currency | currencySymbol" class="currency"></span>{{ costs.tax | price }}</td></tr><tr class="total"><td>total</td><td><span ng-bind-html="currency | currencySymbol" class="currency"></span>{{ costs.total | price }}</td></tr></tbody></table>')}]);
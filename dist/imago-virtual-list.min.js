var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e,r){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@"},link:function(o,l,n,a,s){var u,c;return s(o,function(t){return l.children().append(t)}),u={},u.scrollTop=0,o.init=function(){return!this.calculating&&(this.calculating=!0,o.imagovirtuallist.data)?(n.imagoVirtualListContainer?l[0].addEventListener("scroll",o.onScrollContainer):angular.element(t).on("scroll",o.onScrollWindow),o.imagovirtuallist.offsetBottom||(o.imagovirtuallist.offsetBottom=t.innerHeight),o.resetSize(),r(function(t){return function(){var i,e;return e=document.createElement("div"),e.className=n.classItem,e.id="master-item",l.append(e),u.rowWidth=e.clientWidth,u.rowHeight=e.clientHeight,angular.element(l[0].querySelector("#master-item")).remove(),u.width=l[0].clientWidth,u.height=l[0].clientHeight,u.itemsPerRow=Math.floor(u.width/u.rowWidth),i=Math.round(u.height/u.rowHeight),u.cellsPerPage=i*u.itemsPerRow,u.numberOfCells=3*u.cellsPerPage,u.updateData(),t.calculating=!1}}(this),300)):void 0},u.updateData=function(){return u.canvasHeight=Math.ceil(o.imagovirtuallist.data.length/u.itemsPerRow)*u.rowHeight,o.canvasStyle={height:u.canvasHeight+"px"},u.updateDisplayList()},u.updateDisplayList=function(){var t,i,e,r,l,n,a,s;for(l=Math.max(Math.round(u.scrollTop/u.rowHeight)-Math.round(u.height/u.rowHeight),0),t=Math.min(l+u.numberOfCells,u.numberOfCells),e=l*u.itemsPerRow,o.visibleProvider=o.imagovirtuallist.data.slice(e,e+t),i=_.chunk(o.visibleProvider,u.itemsPerRow),n=0,s=o.visibleProvider.length;s>n;)r=function(){var t,e,r,l,a,s,u,c,m;for(r=s=0,c=i.length;c>s;r=++s)for(t=i[r],l=u=0,m=t.length;m>u;l=++u)if(a=t[l],a._id===o.visibleProvider[n]._id)return e={chunk:r,inside:l}},a=r(),o.visibleProvider[n].styles={transform:"translate("+(u.rowWidth*a.inside+"px")+", "+((l+a.chunk)*u.rowHeight+"px")+")"},n++;return o.imagovirtuallist.scroll?o.scroll():void 0},o.scroll=function(){return o.imagovirtuallist.scroll?r(function(){return u.scrollTop=angular.copy(o.imagovirtuallist.scroll),o.imagovirtuallist.scroll=0,i.scrollTop(u.scrollTop,0)}):void 0},o.onScrollContainer=function(){return u.scrollTop=l.prop("scrollTop"),u.updateDisplayList(),o.$digest()},o.onScrollWindow=function(){return u.scrollTop=t.scrollY,u.canvasHeight-u.scrollTop<=Number(o.imagovirtuallist.offsetBottom)&&o.imagovirtuallist.onBottom(),u.updateDisplayList(),o.$digest()},o.resetSize=function(){return o.visibleProvider=[],o.canvasStyle={},u.cellsPerPage=0,u.numberOfCells=0,u.width=0,u.height=0},o.init(),o.$watch("imagovirtuallist.data",function(){return u.updateData()}),c=[],c.push(e.$on("imagovirtuallist:init",function(){return o.init()})),c.push(e.$on("resizestop",function(){return o.init()})),o.$on("$destroy",function(){var i,e,r,o;for(angular.element(t).off("scroll"),r=[],i=0,e=c.length;e>i;i++)o=c[i],r.push(o());return r})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);
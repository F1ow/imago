var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e,l){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@"},link:function(o,n,r,a,s){var u,c,m;return s(o,function(t){return n.children().append(t)}),c={},c.scrollTop=0,o.imagovirtuallist.offsetBottom||(o.imagovirtuallist.offsetBottom=t.innerHeight),u=document.createElement("div"),u.id="master-item",u.className=r.classItem,u.style.opacity=0,u.style.zIndex=-1,n.append(u),o.init=function(){return o.imagovirtuallist.data&&!this.calculating?(this.calculating=!0,r.imagoVirtualListContainer?n[0].addEventListener("scroll",o.onScrollContainer):angular.element(t).on("scroll",o.onScrollWindow),o.resetSize(),l(function(t){return function(){var i;return c.height=n[0].clientHeight,c.itemsPerRow=Math.floor(n[0].clientWidth/u.clientWidth),i=Math.round(c.height/u.clientHeight),c.cellsPerPage=i*c.itemsPerRow,c.numberOfCells=3*c.cellsPerPage,c.canvasWidth=c.itemsPerRow*u.clientWidth,c.updateData(),t.calculating=!1}}(this),200)):void 0},c.updateData=function(){return c.canvasHeight=Math.ceil(o.imagovirtuallist.data.length/c.itemsPerRow)*u.clientHeight,o.canvasStyle={height:c.canvasHeight+"px",width:c.canvasWidth+"px"},c.updateDisplayList()},c.updateDisplayList=function(){var t,i,e,l,n,r,a,s;for(n=Math.max(Math.round(c.scrollTop/u.clientHeight)-Math.round(c.height/u.clientHeight),0),t=Math.min(n+c.numberOfCells,c.numberOfCells),e=n*c.itemsPerRow,o.visibleProvider=o.imagovirtuallist.data.slice(e,e+t),i=_.chunk(o.visibleProvider,c.itemsPerRow),r=0,s=o.visibleProvider.length;s>r;)l=function(){var t,e,l,n,a,s,u,c,m;for(l=s=0,c=i.length;c>s;l=++s)for(t=i[l],n=u=0,m=t.length;m>u;n=++u)if(a=t[n],a._id===o.visibleProvider[r]._id)return e={chunk:l,inside:n}},a=l(),o.visibleProvider[r].styles={transform:"translate("+(u.clientWidth*a.inside+"px")+", "+((n+a.chunk)*u.clientHeight+"px")+")"},r++;return o.imagovirtuallist.scroll?o.scroll():void 0},o.scroll=function(){return o.imagovirtuallist.scroll?l(function(){return c.scrollTop=angular.copy(o.imagovirtuallist.scroll),o.imagovirtuallist.scroll=0,i.scrollTop(c.scrollTop,0)}):void 0},o.onScrollContainer=function(){return c.scrollTop=n.prop("scrollTop"),c.updateDisplayList(),o.$digest()},o.onScrollWindow=function(){return c.scrollTop=t.scrollY,c.canvasHeight-c.scrollTop<=Number(o.imagovirtuallist.offsetBottom)&&o.imagovirtuallist.onBottom(),c.updateDisplayList(),o.$digest()},o.resetSize=function(){return o.visibleProvider=[],o.canvasStyle={},c.cellsPerPage=0,c.numberOfCells=0,c.height=0},o.init(),o.$watch("imagovirtuallist.data",function(){return c.updateData()}),angular.element(t).on("resize",function(t){return function(){return Math.floor(n[0].clientWidth/u.clientWidth)!==c.itemsPerRow?o.init():void 0}}(this)),m=[],m.push(e.$on("imagovirtuallist:init",function(){return o.init()})),o.$on("$destroy",function(){var i,e,l,o;for(angular.element(t).off("scroll"),l=[],i=0,e=m.length;e>i;i++)o=m[i],l.push(o());return l})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);
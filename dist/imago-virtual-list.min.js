var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e,n){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@"},link:function(l,r,o,a,s){var u,c,m;return s(l,function(t){return r.children().append(t)}),c={},c.scrollTop=0,l.imagovirtuallist.offsetBottom||(l.imagovirtuallist.offsetBottom=t.innerHeight),u=document.createElement("div"),u.id="master-item",u.className=o.classItem,u.style.opacity=0,u.style.zIndex=-1,r.append(u),l.init=function(){return this.initRunning?void 0:(this.initRunning=!0,n(function(i){return function(){var e;return l.resetSize(),c.itemsPerRow=Math.floor(r[0].clientWidth/u.clientWidth),e=Math.round(t.innerHeight/u.clientHeight),c.cellsPerPage=e*c.itemsPerRow,c.numberOfCells=3*c.cellsPerPage,c.itemsPerRow>1&&(c.canvasWidth=c.itemsPerRow*u.clientWidth),c.updateData(),i.initRunning=!1}}(this),100))},c.updateData=function(){return l.imagovirtuallist.data?(c.canvasHeight=Math.ceil(l.imagovirtuallist.data.length/c.itemsPerRow)*u.clientHeight,l.canvasStyle={height:c.canvasHeight+"px",width:c.canvasWidth+"px"},c.updateDisplayList()):void 0},c.updateDisplayList=function(){var i,e,n,r,o,a,s,m;for(o=Math.max(Math.round(c.scrollTop/u.clientHeight)-Math.round(t.innerHeight/u.clientHeight),0),i=Math.min(o+c.numberOfCells,c.numberOfCells),n=o*c.itemsPerRow,l.visibleProvider=l.imagovirtuallist.data.slice(n,n+i),e=_.chunk(l.visibleProvider,c.itemsPerRow),a=0,m=l.visibleProvider.length;m>a;)r=function(){var t,i,n,r,o,s,u,c,m;for(n=s=0,c=e.length;c>s;n=++s)for(t=e[n],r=u=0,m=t.length;m>u;r=++u)if(o=t[r],o._id===l.visibleProvider[a]._id)return i={chunk:n,inside:r}},s=r(),l.visibleProvider[a].styles={transform:"translate("+(u.clientWidth*s.inside+"px")+", "+((o+s.chunk)*u.clientHeight+"px")+")"},a++;return l.imagovirtuallist.scroll?l.scroll():void 0},l.scroll=function(){return l.imagovirtuallist.scroll?n(function(){return c.scrollTop=angular.copy(l.imagovirtuallist.scroll),l.imagovirtuallist.scroll=0,i.scrollTop(c.scrollTop,0)}):void 0},l.onScroll=function(){return c.scrollTop=t.scrollY,c.canvasHeight-c.scrollTop<=Number(l.imagovirtuallist.offsetBottom)&&l.imagovirtuallist.onBottom(),c.updateDisplayList(),l.$digest()},l.resetSize=function(){return l.visibleProvider=[],l.canvasStyle={},c.cellsPerPage=0,c.numberOfCells=0},l.init(),l.$watch("imagovirtuallist.data",function(t){return c.updateData()}),angular.element(t).on("resize",function(t){return function(){return Math.floor(r[0].clientWidth/u.clientWidth)!==c.itemsPerRow?l.init():void 0}}(this)),angular.element(t).on("scroll",l.onScroll),m=[],m.push(e.$on("imagovirtuallist:init",function(){return l.init()})),l.$on("$destroy",function(){var i,e,n,r;for(angular.element(t).off("scroll",l.onScroll),n=[],i=0,e=m.length;e>i;i++)r=m[i],n.push(r());return n})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);
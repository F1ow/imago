var ImagoVirtualList;ImagoVirtualList=function(){function i(i){return{scope:{data:"=",rowHeight:"=",rowWidth:"="},templateUrl:"/imago/imago-virtual-list.html",transclude:!0,link:function(i,t,e,r,o){return o(i,function(i,e){return t.children().append(i)}),i.width=t[0].clientWidth,i.scrollTop=0,i.visibleProvider=[],i.cellsPerPage=0,i.numberOfCells=0,i.canvasHeight={},i.init=function(){return i.height=t[0].clientHeight,t[0].addEventListener("scroll",i.onScroll),i.itemsPerRow=Math.round(i.width/i.rowWidth),i.cellsPerPage=Math.round(i.height/i.rowHeight)*i.itemsPerRow,i.numberOfCells=3*i.cellsPerPage,i.canvasHeight={height:Math.ceil(i.data.length*i.rowHeight/i.itemsPerRow)+"px"},i.updateDisplayList()},i.updateDisplayList=function(){var t,e,r,o,a,l,n,s,h;if(a=Math.max(Math.floor(i.scrollTop/i.rowHeight)-Math.round(i.height/i.rowHeight),0),t=Math.min(a+i.numberOfCells,i.numberOfCells),s=angular.copy(i.visibleProvider),r=a*i.itemsPerRow,i.visibleProvider=i.data.slice(r,r+t),!angular.equals(i.visibleProvider,s)){for(e=_.chunk(i.visibleProvider,i.itemsPerRow),l=0,h=[];l<i.visibleProvider.length;)o=function(){var t,r,o,a,n,s,h,u,d;for(o=s=0,u=e.length;u>s;o=++s)for(t=e[o],a=h=0,d=t.length;d>h;a=++h)if(n=t[a],n._id===i.visibleProvider[l]._id)return r={chunk:o,inside:a}},n=o(),i.visibleProvider[l].styles={transform:"translate3d("+(i.rowWidth*n.inside+"px")+", "+((a+n.chunk)*i.rowHeight+"px")+", 0)"},h.push(l++);return h}},i.onScroll=function(){return i.scrollTop=t.prop("scrollTop"),i.updateDisplayList(),i.$apply()},i.$watchGroup(["data","rowHeight","rowWidth"],function(){var t;if(i.data&&i.rowWidth&&i.rowHeight)return"string"==typeof i.rowWidth&&(t=parseInt(i.rowWidth)/100,i.rowWidth=i.width*t),i.init()})}}}return i}(),angular.module("imago").directive("imagoVirtualList",["$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
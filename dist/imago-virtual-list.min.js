var ImagoVirtualList;ImagoVirtualList=function(){function i(i,t){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",rowHeight:"=",rowWidth:"="},link:function(r,e,l,a,o){var n;return o(r,function(i,t){return e.children().append(i)}),r.scrollTop=0,r.width=e[0].clientWidth,r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.canvasHeight={},r.init=function(t,a){var o;return t&&a||(o=document.createElement("div"),o.className=l.classitem,o.id="virtual-list-test-div",e.append(o),t=t||o.clientWidth,a=a||o.clientHeight,angular.element(e[0].querySelector("#virtual-list-test-div")).remove()),r.rowWidth=t,r.rowHeight=a,r.width||(r.width=e[0].clientWidth),r.height||(r.height=e[0].clientHeight),l.imagoVirtualListContainer?e[0].addEventListener("scroll",r.onScrollContainer):angular.element(i).on("scroll",r.onScrollWindow),r.itemsPerRow=Math.round(r.width/r.rowWidth),r.canvasHeight={height:Math.ceil(r.imagovirtuallist.data.length*r.rowHeight/r.itemsPerRow)+"px"},r.cellsPerPage=Math.round(r.height/r.rowHeight)*r.itemsPerRow,r.numberOfCells=3*r.cellsPerPage,r.margin=0,r.updateDisplayList()},r.updateDisplayList=function(){var i,t,e,l,a,o,n,s;for(a=Math.max(Math.floor(r.scrollTop/r.rowHeight)-Math.round(r.height/r.rowHeight),0),i=Math.min(a+r.numberOfCells,r.numberOfCells),e=a*r.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(e,e+i),t=_.chunk(r.visibleProvider,r.itemsPerRow),o=0,s=[];o<r.visibleProvider.length;)l=function(){var i,e,l,a,n,s,u,g,d;for(l=s=0,g=t.length;g>s;l=++s)for(i=t[l],a=u=0,d=i.length;d>u;a=++u)if(n=i[a],n._id===r.visibleProvider[o]._id)return e={chunk:l,inside:a}},n=l(),r.visibleProvider[o].styles={transform:"translate3d("+(r.rowWidth*n.inside+r.margin+"px")+", "+((a+n.chunk)*r.rowHeight+"px")+", 0)"},s.push(o++);return s},r.onScrollContainer=function(){return r.scrollTop=e.prop("scrollTop"),r.updateDisplayList(),r.$apply()},r.onScrollWindow=function(){return r.scrollTop=i.pageYOffset,r.updateDisplayList(),r.$apply()},r.$watchGroup(["imagovirtuallist.data","imagovirtuallist.rowHeight","imagovirtuallist.rowWidth"],function(){var i,t;if(r.imagovirtuallist.data)return angular.isString(r.imagovirtuallist.rowWidth)?(t=parseInt(r.imagovirtuallist.rowWidth)/100,t=r.width*t):angular.isDefined(r.imagovirtuallist.rowWidth)&&(t=r.imagovirtuallist.rowWidth),angular.isDefined(r.imagovirtuallist.rowHeight)&&(i=r.imagovirtuallist.rowHeight),r.init(t,i)}),n=t.$on("imagovirtuallist:init",function(){return r.init()}),r.$on("$destroy",function(){return angular.element(i).off("scroll",r.onScrollWindow),n()})}}}return i}(),angular.module("imago").directive("imagoVirtualList",["$window","$rootScope",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",rowHeight:"=",rowWidth:"="},link:function(r,n,l,o,a){var s;return a(r,function(t,i){return n.children().append(t)}),r.scrollTop=0,r.width=n[0].clientWidth,r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.canvasHeight={},r.init=function(){return r.imagovirtuallist.data?e(function(){var i,e;return e=document.createElement("div"),e.className=l.classItem,e.id="virtual-list-test-div",n.append(e),r.rowWidth=e.clientWidth,r.rowHeight=e.clientHeight,angular.element(n[0].querySelector("#virtual-list-test-div")).remove(),r.width||(r.width=n[0].clientWidth),r.height||(r.height=n[0].clientHeight),l.imagoVirtualListContainer?n[0].addEventListener("scroll",r.onScrollContainer):angular.element(t).on("scroll",r.onScrollWindow),r.itemsPerRow=Math.round(r.width/r.rowWidth),r.canvasHeight={height:Math.ceil(r.imagovirtuallist.data.length*r.rowHeight/r.itemsPerRow)+"px"},i=Math.round(r.height/r.rowHeight),r.cellsPerPage=i*r.itemsPerRow,r.numberOfCells=i===Math.ceil(r.height/r.rowHeight)?3*r.cellsPerPage:4*r.cellsPerPage,r.margin=0,r.updateDisplayList()},50):void 0},r.updateDisplayList=function(){var t,i,e,n,l,o,a,s;for(l=Math.max(Math.floor(r.scrollTop/r.rowHeight)-Math.round(r.height/r.rowHeight),0),t=Math.min(l+r.numberOfCells,r.numberOfCells),e=l*r.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(e,e+t),i=_.chunk(r.visibleProvider,r.itemsPerRow),o=0,s=[];o<r.visibleProvider.length;)n=function(){var t,e,n,l,a,s,u,c,h;for(n=s=0,c=i.length;c>s;n=++s)for(t=i[n],l=u=0,h=t.length;h>u;l=++u)if(a=t[l],a._id===r.visibleProvider[o]._id)return e={chunk:n,inside:l}},a=n(),r.visibleProvider[o].styles={transform:"translate("+(r.rowWidth*a.inside+r.margin+"px")+", "+((l+a.chunk)*r.rowHeight+"px")+")"},s.push(o++);return s},r.onScrollContainer=function(){return r.scrollTop=n.prop("scrollTop"),r.updateDisplayList(),r.$digest()},r.onScrollWindow=function(){return r.scrollTop=t.pageYOffset,r.updateDisplayList(),r.$digest()},r.$watch("imagovirtuallist.data",function(){return r.init()}),s=[],s.push(i.$on("imagovirtuallist:init",function(){return r.init()})),s.push(i.$on("resizestop",function(){return r.init()})),r.$on("$destroy",function(){var i,e,n,l;for(angular.element(t).off("scroll",r.onScrollWindow),n=[],i=0,e=s.length;e>i;i++)l=s[i],n.push(l());return n})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
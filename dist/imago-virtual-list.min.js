var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,r,e){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"="},link:function(l,o,n,a,s){var u,c;return s(l,function(t){return o.children().append(t)}),u={},u.scrollTop=0,l.init=function(){return l.imagovirtuallist.data?(n.imagoVirtualListContainer?o[0].addEventListener("scroll",l.onScrollContainer):angular.element(t).on("scroll",l.onScrollWindow),l.resetSize(),e(function(){var t,i;return i=document.createElement("div"),i.className=n.classItem,i.id="virtual-list-test-div",o.append(i),u.rowWidth=i.clientWidth,u.rowHeight=i.clientHeight,angular.element(o[0].querySelector("#virtual-list-test-div")).remove(),u.width=o[0].clientWidth,u.height=o[0].clientHeight,u.itemsPerRow=Math.floor(u.width/u.rowWidth),t=Math.round(u.height/u.rowHeight),u.cellsPerPage=t*u.itemsPerRow,u.numberOfCells=3*u.cellsPerPage,u.updateData()},200)):void 0},u.updateData=function(){return u.canvasHeight=Math.ceil(l.imagovirtuallist.data.length/u.itemsPerRow)*u.rowHeight,l.canvasStyle={height:u.canvasHeight+"px"},u.updateDisplayList()},u.updateDisplayList=function(){var t,i,r,e,o,n,a,s;for(o=Math.max(Math.round(u.scrollTop/u.rowHeight)-Math.round(u.height/u.rowHeight),0),t=Math.min(o+u.numberOfCells,u.numberOfCells),r=o*u.itemsPerRow,l.visibleProvider=l.imagovirtuallist.data.slice(r,r+t),i=_.chunk(l.visibleProvider,u.itemsPerRow),n=0,s=l.visibleProvider.length;s>n;)e=function(){var t,r,e,o,a,s,u,c,d;for(e=s=0,c=i.length;c>s;e=++s)for(t=i[e],o=u=0,d=t.length;d>u;o=++u)if(a=t[o],a._id===l.visibleProvider[n]._id)return r={chunk:e,inside:o}},a=e(),l.visibleProvider[n].styles={transform:"translate("+(u.rowWidth*a.inside+"px")+", "+((o+a.chunk)*u.rowHeight+"px")+")"},n++;return l.imagovirtuallist.scroll?l.scroll():void 0},l.scroll=function(){return l.imagovirtuallist.scroll?e(function(){return u.scrollTop=angular.copy(l.imagovirtuallist.scroll),l.imagovirtuallist.scroll=0,i.scrollTop(u.scrollTop,0)}):void 0},l.onScrollContainer=function(){return u.scrollTop=o.prop("scrollTop"),u.updateDisplayList(),l.$digest()},l.onScrollWindow=function(){return u.scrollTop=t.scrollY,u.canvasHeight-u.scrollTop<=t.innerHeight&&l.imagovirtuallist.onBottom(),u.updateDisplayList(),l.$digest()},l.resetSize=function(){return l.visibleProvider=[],l.canvasStyle={},u.cellsPerPage=0,u.numberOfCells=0,u.width=0,u.height=0},l.init(),l.$watch("imagovirtuallist.data",function(){return u.updateData()}),c=[],c.push(r.$on("imagovirtuallist:init",function(){return l.init()})),c.push(r.$on("resizestop",function(){return l.init()})),l.$on("$destroy",function(){var i,r,e,o;for(angular.element(t).off("scroll",l.onScrollWindow),e=[],i=0,r=c.length;r>i;i++)o=c[i],e.push(o());return e})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);
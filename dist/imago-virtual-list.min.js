var ImagoVirtualList;ImagoVirtualList=function(){function i(i,t,e){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",rowHeight:"=",rowWidth:"="},link:function(r,n,l,o,a){var s;return a(r,function(i){return n.children().append(i)}),r.scrollTop=0,r.width=n[0].clientWidth,r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.canvasHeight={},r.init=function(){return r.imagovirtuallist.data?e(function(){var t,e;return e=document.createElement("div"),e.className=l.classItem,e.id="virtual-list-test-div",n.append(e),r.rowWidth=e.clientWidth,r.rowHeight=e.clientHeight,angular.element(n[0].querySelector("#virtual-list-test-div")).remove(),r.width||(r.width=n[0].clientWidth),r.height||(r.height=n[0].clientHeight),l.imagoVirtualListContainer?n[0].addEventListener("scroll",r.onScrollContainer):angular.element(i).on("scroll",r.onScrollWindow),r.itemsPerRow=Math.round(r.width/r.rowWidth),r.canvasHeight={height:Math.ceil(r.imagovirtuallist.data.length*r.rowHeight/r.itemsPerRow)+"px"},t=Math.round(r.height/r.rowHeight),r.cellsPerPage=t*r.itemsPerRow,r.numberOfCells=3*r.cellsPerPage,r.margin=0,r.updateDisplayList()},50):void 0},r.updateDisplayList=function(){var i,t,e,n,l,o,a,s;for(l=Math.max(Math.floor(r.scrollTop/r.rowHeight)-Math.round(r.height/r.rowHeight),0),i=Math.min(l+r.numberOfCells,r.numberOfCells),e=l*r.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(e,e+i),t=_.chunk(r.visibleProvider,r.itemsPerRow),o=0,s=[];o<r.visibleProvider.length;)n=function(){var i,e,n,l,a,s,u,c,d;for(n=s=0,c=t.length;c>s;n=++s)for(i=t[n],l=u=0,d=i.length;d>u;l=++u)if(a=i[l],a._id===r.visibleProvider[o]._id)return e={chunk:n,inside:l}},a=n(),r.visibleProvider[o].styles={transform:"translate("+(r.rowWidth*a.inside+r.margin+"px")+", "+((l+a.chunk)*r.rowHeight+"px")+")"},s.push(o++);return s},r.onScrollContainer=function(){return r.scrollTop=n.prop("scrollTop"),r.updateDisplayList(),r.$digest()},r.onScrollWindow=function(){return r.scrollTop=i.pageYOffset,r.updateDisplayList(),r.$digest()},r.resetSize=function(){return r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.canvasHeight={},r.$digest()},r.$watch("imagovirtuallist.data",function(){return r.init()}),s=[],s.push(t.$on("imagovirtuallist:init",function(){return r.init()})),s.push(t.$on("resizestop",function(){return r.resetSize(),r.init()})),r.$on("$destroy",function(){var t,e,n,l;for(angular.element(i).off("scroll",r.onScrollWindow),n=[],t=0,e=s.length;e>t;t++)l=s[t],n.push(l());return n})}}}return i}(),angular.module("imago").directive("imagoVirtualList",["$window","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
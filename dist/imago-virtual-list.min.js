var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",rowHeight:"=",rowWidth:"="},link:function(r,l,n,o,a){var s;return a(r,function(t){return l.children().append(t)}),r.scrollTop=0,r.width=l[0].clientWidth,r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.canvasHeight={},r.times=0,r.total=0,r.init=function(){return r.imagovirtuallist.data?e(function(){var i,e;return e=document.createElement("div"),e.className=n.classItem,e.id="virtual-list-test-div",l.append(e),r.rowWidth=e.clientWidth,r.rowHeight=e.clientHeight,angular.element(l[0].querySelector("#virtual-list-test-div")).remove(),r.width||(r.width=l[0].clientWidth),r.height||(r.height=l[0].clientHeight),n.imagoVirtualListContainer?l[0].addEventListener("scroll",r.onScrollContainer):angular.element(t).on("scroll",r.onScrollWindow),r.itemsPerRow=Math.round(r.width/r.rowWidth),r.canvasHeight={height:Math.ceil(r.imagovirtuallist.data.length*r.rowHeight/r.itemsPerRow)+"px"},i=Math.round(r.height/r.rowHeight),r.cellsPerPage=i*r.itemsPerRow,r.numberOfCells=i===Math.ceil(r.height/r.rowHeight)?3*r.cellsPerPage:4*r.cellsPerPage,r.margin=0,r.updateDisplayList()},50):void 0},r.updateDisplayList=function(){var t,i,e,l,n,o,a,s,u;for(n=Math.max(Math.floor(r.scrollTop/r.rowHeight)-Math.round(r.height/r.rowHeight),0),t=Math.min(n+r.numberOfCells,r.numberOfCells),e=n*r.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(e,e+t),i=_.chunk(r.visibleProvider,r.itemsPerRow),o=0,s=r.visibleProvider.length,u=[];s>o;)l=function(){var t,e,l,n,a,s,u,c,h;for(l=s=0,c=i.length;c>s;l=++s)for(t=i[l],n=u=0,h=t.length;h>u;n=++u)if(a=t[n],a._id===r.visibleProvider[o]._id)return e={chunk:l,inside:n}},a=l(),r.visibleProvider[o].styles={transform:"translate3d("+(r.rowWidth*a.inside+r.margin+"px")+", "+((n+a.chunk)*r.rowHeight+"px")+", 0)"},u.push(o++);return u},r.onScrollContainer=function(){return r.scrollTop=l.prop("scrollTop"),r.updateDisplayList(),r.$digest()},r.onScrollWindow=function(){return r.scrollTop=t.pageYOffset,r.updateDisplayList(),r.$digest()},r.resetSize=function(){return r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.width=0,r.height=0,r.canvasHeight={},r.$digest()},r.$watch("imagovirtuallist.data",function(){return r.init()}),s=[],s.push(i.$on("imagovirtuallist:init",function(){return r.init()})),s.push(i.$on("resizestop",function(){return r.resetSize(),r.init()})),r.$on("$destroy",function(){var i,e,l,n;for(angular.element(t).off("scroll",r.onScrollWindow),l=[],i=0,e=s.length;e>i;i++)n=s[i],l.push(n());return l})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"="},link:function(r,o,n,l,a){var s;return a(r,function(t){return o.children().append(t)}),r.scrollTop=0,r.init=function(){return r.imagovirtuallist.data?(r.resetSize(),e(function(){var i,e;return e=document.createElement("div"),e.className=n.classItem,e.id="virtual-list-test-div",o.append(e),r.rowWidth=e.clientWidth,r.rowHeight=e.clientHeight,angular.element(o[0].querySelector("#virtual-list-test-div")).remove(),r.width=o[0].clientWidth,r.height=o[0].clientHeight,n.imagoVirtualListContainer?o[0].addEventListener("scroll",r.onScrollContainer):angular.element(t).on("scroll",r.onScrollWindow),r.itemsPerRow=Math.floor(r.width/r.rowWidth),r.canvasHeight={height:Math.ceil(r.imagovirtuallist.data.length/r.itemsPerRow)*r.rowHeight+"px"},i=Math.round(r.height/r.rowHeight),r.cellsPerPage=i*r.itemsPerRow,r.numberOfCells=i===Math.ceil(r.height/r.rowHeight)?3*r.cellsPerPage:4*r.cellsPerPage,r.updateDisplayList()})):void 0},r.updateDisplayList=function(){var t,i,e,o,n,l,a,s,u,c;for(n=Math.max(Math.floor(r.scrollTop/r.rowHeight)-Math.round(r.height/r.rowHeight),0),t=Math.min(n+r.numberOfCells,r.numberOfCells),e=n*r.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(e,e+t),i=_.chunk(r.visibleProvider,r.itemsPerRow),l=0,s=r.visibleProvider.length,u=Math.round(r.width/r.itemsPerRow-r.rowWidth),1===r.itemsPerRow&&(u/=2),c=[];s>l;)o=function(){var t,e,o,n,a,s,u,c,h;for(o=s=0,c=i.length;c>s;o=++s)for(t=i[o],n=u=0,h=t.length;h>u;n=++u)if(a=t[n],a._id===r.visibleProvider[l]._id)return e={chunk:o,inside:n}},a=o(),r.visibleProvider[l].styles={transform:"translate("+(r.rowWidth*a.inside+u+"px")+", "+((n+a.chunk)*r.rowHeight+"px")+")"},c.push(l++);return c},r.onScrollContainer=function(){return r.scrollTop=o.prop("scrollTop"),r.updateDisplayList(),r.$digest()},r.onScrollWindow=function(){return r.scrollTop=t.pageYOffset,r.updateDisplayList(),r.$digest()},r.resetSize=function(){return r.visibleProvider=[],r.cellsPerPage=0,r.numberOfCells=0,r.width=0,r.height=0,r.canvasHeight={}},r.$watch("imagovirtuallist.data",function(){return r.init()}),s=[],s.push(i.$on("imagovirtuallist:init",function(){return r.init()})),s.push(i.$on("resizestop",function(){return r.init()})),r.$on("$destroy",function(){var i,e,o,n;for(angular.element(t).off("scroll",r.onScrollWindow),o=[],i=0,e=s.length;e>i;i++)n=s[i],o.push(n());return o})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasHeight" class="canvas"></div>')}]);
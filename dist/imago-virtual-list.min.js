var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e,l){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@"},link:function(n,r,o,a,s){var c,u,m;return s(n,function(t){return r.children().append(t)}),u={},u.scrollTop=0,n.imagovirtuallist.offsetBottom||(n.imagovirtuallist.offsetBottom=t.innerHeight),c=document.createElement("div"),c.id="master-item",c.className=o.classItem,c.style.opacity=0,r.append(c),n.init=function(){return n.imagovirtuallist.data&&!this.calculating?(this.calculating=!0,o.imagoVirtualListContainer?r[0].addEventListener("scroll",n.onScrollContainer):angular.element(t).on("scroll",n.onScrollWindow),n.resetSize(),l(function(t){return function(){var i;return u.height=r[0].clientHeight,u.itemsPerRow=Math.floor(r[0].clientWidth/c.clientWidth),i=Math.round(u.height/c.clientHeight),u.cellsPerPage=i*u.itemsPerRow,u.numberOfCells=3*u.cellsPerPage,u.margin=(r[0].clientWidth-u.itemsPerRow*c.clientWidth)/2,u.updateData(),t.calculating=!1}}(this),300)):void 0},u.updateData=function(){return u.canvasHeight=Math.ceil(n.imagovirtuallist.data.length/u.itemsPerRow)*c.clientHeight,n.canvasStyle={height:u.canvasHeight+"px",margin:"0 "+u.margin+"px"},u.updateDisplayList()},u.updateDisplayList=function(){var t,i,e,l,r,o,a,s;for(r=Math.max(Math.round(u.scrollTop/c.clientHeight)-Math.round(u.height/c.clientHeight),0),t=Math.min(r+u.numberOfCells,u.numberOfCells),e=r*u.itemsPerRow,n.visibleProvider=n.imagovirtuallist.data.slice(e,e+t),i=_.chunk(n.visibleProvider,u.itemsPerRow),o=0,s=n.visibleProvider.length;s>o;)l=function(){var t,e,l,r,a,s,c,u,m;for(l=s=0,u=i.length;u>s;l=++s)for(t=i[l],r=c=0,m=t.length;m>c;r=++c)if(a=t[r],a._id===n.visibleProvider[o]._id)return e={chunk:l,inside:r}},a=l(),n.visibleProvider[o].styles={transform:"translate("+(c.clientWidth*a.inside+"px")+", "+((r+a.chunk)*c.clientHeight+"px")+")"},o++;return n.imagovirtuallist.scroll?n.scroll():void 0},n.scroll=function(){return n.imagovirtuallist.scroll?l(function(){return u.scrollTop=angular.copy(n.imagovirtuallist.scroll),n.imagovirtuallist.scroll=0,i.scrollTop(u.scrollTop,0)}):void 0},n.onScrollContainer=function(){return u.scrollTop=r.prop("scrollTop"),u.updateDisplayList(),n.$digest()},n.onScrollWindow=function(){return u.scrollTop=t.scrollY,u.canvasHeight-u.scrollTop<=Number(n.imagovirtuallist.offsetBottom)&&n.imagovirtuallist.onBottom(),u.updateDisplayList(),n.$digest()},n.resetSize=function(){return n.visibleProvider=[],n.canvasStyle={},u.cellsPerPage=0,u.numberOfCells=0,u.height=0},n.init(),n.$watch("imagovirtuallist.data",function(){return u.updateData()}),angular.element(t).on("resize",function(t){return function(){return Math.floor(r[0].clientWidth/c.clientWidth)!==u.itemsPerRow?n.init():(u.margin=(r[0].clientWidth-u.itemsPerRow*c.clientWidth)/2,n.canvasStyle.margin="0 "+u.margin+"px",n.$digest())}}(this)),m=[],m.push(e.$on("imagovirtuallist:init",function(){return n.init()})),n.$on("$destroy",function(){var i,e,l,n;for(angular.element(t).off("scroll"),l=[],i=0,e=m.length;e>i;i++)n=m[i],l.push(n());return l})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);